<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 6.13.1 (455785)"/><meta name="keywords" content="内存管理, Xcode"/><meta name="author" content="moonbeammm丶"/><meta name="created" content="2017-06-15 03:41:58 +0000"/><meta name="source" content="desktop.mac"/><meta name="updated" content="2017-12-07 03:15:59 +0000"/><title>2017/6/15-循环引用/内存泄漏检测工具</title></head><body><div>update log:</div><div>2017.10.8: 升了xcode9使用这个工具的时候发现不显示了.原来需要打开Zombie Objects.打开路径为 Edit Scheme -&gt; Diagnostics -&gt; 勾选Zombie Objects</div><div><br/></div><div>Update log:</div><div>2017.12.7: 如果你连接的模拟器或者真机是iOS8及以下的系统.是没有这个功能的.</div><div><br/></div><div>Update log:</div><div>2017.12.7: 一直显示no selector.</div><div>解决办法: 重启大法.</div><div><a href="https://stackoverflow.com/questions/40500625/xcode-8-memory-graph-says-no-selection-and-not-working">stackoverflow</a></div><div><br/></div><div><span style="font-size: 24px;">一.循环引用检查工具</span></div><div>当你进入一个vc.然后退出的时候.发现他没走dealloc方法.然后把这个vc里的代码从头到尾看了一遍.满心欢喜的运行.进入vc再退出发现还是没走dealloc.不知道你的内心如何.反正我的内心是毫无波澜只有一句***.</div><div><br/></div><div>现在有个很好的工具可以直接显示是谁强引用了这个vc.不需要你从头到尾一行行找.</div><div><br/></div><div><span style="font-size: 26px;">二.工具使用方法</span></div><div>这个是xcode自带工具.不过只能在模拟器下使用.</div><div>1.首先进入那个没有正常释放的vc.然后退出.</div><div>2.点击调试工具栏里的Debug Memory Graph工具.如图.</div><div><img src="2017_6_15-%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8_%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%E6%A3%80%E6%B5%8B%E5%B7%A5%E5%85%B7.resources/D0975E9A-8C2F-4323-BEBC-1B0C3EB23248.png" height="59" width="460"/><br/></div><div>3.进入Debug Memory Graph工具后.在左侧的导航栏1处输入没释放的那个vc的类名.在2处就可以找到该类(如果他确实没被释放就一定能找到他);</div><div><img src="2017_6_15-%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8_%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%E6%A3%80%E6%B5%8B%E5%B7%A5%E5%85%B7.resources/A9D16388-7835-493B-92AC-975B7E4B1BE2.png" height="387" width="377"/><br/></div><div>4.在右侧观看谁强引用了该vc.导致他没被释放.如图.</div><div><img src="2017_6_15-%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8_%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%E6%A3%80%E6%B5%8B%E5%B7%A5%E5%85%B7.resources/0B105825-141B-4653-8069-02B15EAC230C.png" height="327" width="928"/><br/></div><div><br/></div><div>5.这时我们就知道了是VideoApi强引用了vc.导致他没被释放.</div><div>然后在该vc里搜索VideoApi关键字.</div><div>发现在api的回调block里使用了  _page.</div><div>没有使用weakself调用.    (应该使用self.page)</div><div>导致了内存泄漏.</div><div><img src="2017_6_15-%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8_%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%E6%A3%80%E6%B5%8B%E5%B7%A5%E5%85%B7.resources/651D7DE1-E109-439F-B5C5-69472662F61D.png" height="155" width="590"/><br/></div><div><br/></div><div>7.恩.结束.</div></body></html>