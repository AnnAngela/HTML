<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 6.13.1 (455785)"/><meta name="keywords" content="Carthage"/><meta name="author" content="moonbeammm丶"/><meta name="created" content="2017-08-23 09:45:48 +0000"/><meta name="source" content="desktop.mac"/><meta name="updated" content="2017-09-22 03:08:07 +0000"/><title>1-2-Carthage踩坑</title></head><body><div><span style="font-size: 28px;">问题一: cartfile.resolved文件什么时候会更新</span></div><div><br/></div><div>1.cartfile里依赖两个库</div><div><img src="1-2-Carthage%E8%B8%A9%E5%9D%91.resources/7B41DAB7-9D41-40E3-A0AA-A6A5B4EFB379.png" height="86" width="513"/><br/></div><div><br/></div><div>2.运行<span style="font: 12.0px 'Andale Mono'; font-variant-ligatures: no-common-ligatures; color: #28fe14; background-color: rgba(30, 30, 30, 0.87);">carthage checkout </span></div><div><img src="1-2-Carthage%E8%B8%A9%E5%9D%91.resources/ADB2659F-1DE3-415B-835C-2E950021667E.png" height="101" width="617"/><br/></div><div>进入cartfile.resolved文件.</div><div><img src="1-2-Carthage%E8%B8%A9%E5%9D%91.resources/FFCEDA66-D622-4B29-9D7B-15A28B3FA6D1.png" height="93" width="481"/><br/></div><div>发现还是之前依赖的库.</div><div><br/></div><div>3.运行<span style="font: 12.0px 'Andale Mono'; font-variant-ligatures: no-common-ligatures; color: #28fe14; background-color: rgba(30, 30, 30, 0.87);">carthage update --platform iOS  </span></div><div><img src="1-2-Carthage%E8%B8%A9%E5%9D%91.resources/EDEB739C-774B-42D3-860F-3C7E01DCC961.png" height="100" width="618"/><br/></div><div><br/></div><div>再进入cartfile.resolved文件</div><div><img src="1-2-Carthage%E8%B8%A9%E5%9D%91.resources/C0211B2A-D7B5-4926-936C-D3C93C043804.png" height="59" width="486"/><br/></div><div><br/></div><div>发现.resolved文件才发生响应的更改.</div><div><br/></div><div><br/></div><div><span style="color: rgb(170, 121, 66);">卡比总结:</span></div><div><span style="color: rgb(170, 121, 66);">cartfile.resolved是遍历整个工程后（包括隐藏依赖的cartfilr）后最终给出的结果 carthage checkou的作用是通过resolved拉取相应代码 所以并不会更新。 脚本内的先执行checkout作用只是为了创建目录树。 所以update的时候才会进行更新。</span></div><div><br/></div><div><br/></div><hr/><div><br/></div><div><span style="font-size: 30px;">问题二:cartfile依赖的库又依赖其他库</span></div><div><br/></div><div>1.cartfile文件里依赖BBAd.(BBAd又对其他库有依赖)</div><div><img src="1-2-Carthage%E8%B8%A9%E5%9D%91.resources/8F16226D-3D75-4623-829C-6C802DCD89CE.png" height="53" width="451"/><br/></div><div><br/></div><div>BBAd的cartfile如下</div><div><img src="1-2-Carthage%E8%B8%A9%E5%9D%91.resources/0830774B-D7C5-44AE-A9F4-367E08ADD83A.png" height="126" width="530"/><br/></div><div><br/></div><div>2.运行<span style="font: 12.0px 'Andale Mono'; font-variant-ligatures: no-common-ligatures; color: #28fe14; background-color: rgba(30, 30, 30, 0.87);">carthage update </span></div><div><img src="1-2-Carthage%E8%B8%A9%E5%9D%91.resources/03693A10-BC04-4920-B338-B5AA80F0116B.png" height="382" width="621"/><br/></div><div><br/></div><div><span style="color: rgb(255, 38, 0);">会发现carthage先fetching了BBAd.紧接着就运行了BBAd工程的</span><span style="color: rgb(255, 38, 0); font-variant-caps: normal; font-size: 12px; line-height: normal; font-family: 'Andale Mono'; font-variant-ligatures: no-common-ligatures; background-color: rgba(30, 30, 30, 0.870588);">carthage checkout </span><span style="color: rgb(255, 38, 0);">命令.</span></div><div><span style="color: rgb(255, 38, 0);">最后才build BBAd工程.</span></div><div><br/></div><div><span style="font-size: 20px;">这就导出四个结论:</span></div><div>1.你依赖的库如果还依赖其他库.那这个库也需要创建cartfile文件.并且填写依赖库地址.</div><div><span style="color: rgb(255, 38, 0);">2.会发现BBAd工程通过carthage拉取的依赖工程都是通过软链的形式link到主工程生成的carthage-&gt;build和carthage-&gt;checkouts目录的.</span></div><div><img src="1-2-Carthage%E8%B8%A9%E5%9D%91.resources/7545F95E-DFF8-4F9F-A6AE-EB5396550482.png" height="185" width="1529"/><br/></div><div><br/></div><div><span style="color: rgb(170, 121, 66);">卡比总结:</span></div><div><span style="color: rgb(170, 121, 66);">结论错，以前我们的库都存在着潜在的兄弟库依赖。对bbad而言 bbad已经做成carthage的向下依赖库并不存在向上依赖。bfc一众代码目前依然采取兄弟依赖</span></div><div><br/></div><div>关于结论一:</div><div>没理解卡比说的错误在哪.</div><div>比如BBPhone依赖BiliCore的源码.</div><div>BiliCore又依赖BiliUtils源码.</div><div><span style="color: rgb(170, 121, 66);">那BiliCore就必须创建cartfile添加对BiliUtils源码的依赖.</span></div><div><img src="1-2-Carthage%E8%B8%A9%E5%9D%91.resources/611B0B39-7653-48D2-86B2-014C548C4DA5.png" height="330" width="1012"/><br/></div><div><br/></div><hr/><div><br/></div><div><span style="font-size: 27px;">问题三:cartfile依赖的库依赖了和你一样的库.且版本号不一致</span></div><div><br/></div><div>1.这是主工程的cartfile文件</div><div><img src="1-2-Carthage%E8%B8%A9%E5%9D%91.resources/B07DDAB5-D73B-4FD3-841A-A3CD6E1A05A5.png" height="71" width="502"/><br/></div><div>2.这是BBAd工程的cartfile文件</div><div><img src="1-2-Carthage%E8%B8%A9%E5%9D%91.resources/454D317C-2D5E-443E-8B82-AD35B3354A41.png" height="123" width="518"/><br/></div><div>3.会发现两个库都依赖了BFCRuler库.但是依赖的tag号不一致.</div><div><br/></div><div>4.运行结果.报错显示cartahge不知道选择哪个tag来拉取依赖库.</div><div><img src="1-2-Carthage%E8%B8%A9%E5%9D%91.resources/ABE875FC-653C-4272-9519-733FB1AFE13E.png" height="199" width="619"/><br/></div><div><br/></div><div><span style="font-size: 26px;">这个报错的解读:</span></div><div><span style="font-family: 'Andale Mono'; color: rgb(40, 254, 20); background-color: rgba(30, 30, 30, 0.870588); font-size: 12px;">could not pick a version for binary “出错的库”, due to mutually incompatible requirements</span></div><div><span style="font-family: 'Andale Mono'; color: rgb(40, 254, 20); background-color: rgba(30, 30, 30, 0.870588); font-size: 12px;">      == 1.0.2      (主工程选择的tag号)</span></div><div><span style="font-family: 'Andale Mono'; color: rgb(40, 254, 20); background-color: rgba(30, 30, 30, 0.870588); font-size: 12px;">      == 1.0.3      (“冲突库选择的tag号”)</span></div><div><br/></div><div>直接去冲突库里把tag改成一致即可.</div><div><br/></div><div><span style="color: rgb(170, 121, 66);">卡比总结:</span></div><div><span style="color: rgb(170, 121, 66);">如问题1 拉取前先要计算resolve 计算冲突即失败。建议开发库不敏感的情况下写通配符.</span></div><div><br/></div><div><br/></div><div><span style="font-size: 27px;">&amp;问题三: 版本不一致导致的问题</span></div><div><span style="font: 12.0px 'Andale Mono'; font-variant-ligatures: no-common-ligatures; color: #28fe14; background-color: rgba(30, 30, 30, 0.87);">No available version for binary "</span><a style="font: 12.0px 'Andale Mono'; font-variant-ligatures: no-common-ligatures; color: #28fe14; background-color: rgba(30, 30, 30, 0.87);" href="https://172.16.0.97/api/v1/carthage/BFCRuler/meta">https://172.16.0.97/api/v1/carthage/BFCRuler/meta</a><span style="font: 12.0px 'Andale Mono'; font-variant-ligatures: no-common-ligatures; color: #28fe14; background-color: rgba(30, 30, 30, 0.87);">" satisfies the requirement: == 1.0.3</span></div><div>没有有效的BFCRuler库版本满足 1.0.3的要求.</div><div><img src="1-2-Carthage%E8%B8%A9%E5%9D%91.resources/22C9BA28-B6C5-4CA8-8A0E-748A609DB14B.png" height="57" width="496"/><br/></div><div><br/></div><div>我就依赖了两个库.检查了BBAd和BiliCore的cartfile文件.发现他们对BFCRuler的依赖都是1.0.3tag号.</div><div><img src="1-2-Carthage%E8%B8%A9%E5%9D%91.resources/CFDF1CC8-C845-456F-89C8-A842577DBEDD.png" height="175" width="570"/><br/></div><div><img src="1-2-Carthage%E8%B8%A9%E5%9D%91.resources/6257B589-8781-43FF-BB4A-9C732CC772E6.png" height="130" width="540"/><br/></div><div><br/></div><div>原因:</div><div>查看他们两个库的cartfile.resolved文件. 发现BiliCore真正依赖的1.0.4.........</div><div><img src="1-2-Carthage%E8%B8%A9%E5%9D%91.resources/CB94D906-82F4-4562-8648-B9C3B6317DDA.png" height="178" width="611"/><br/></div><div><img src="1-2-Carthage%E8%B8%A9%E5%9D%91.resources/1CB47DA3-FB4D-4DED-BEA5-ADFC558726EA.png" height="171" width="607"/><br/></div><div><br/></div><div><br/></div><hr/><div><br/></div><div><span style="font-size: 27px;">问题四.cartfile依赖的库没有shared framworks</span></div><div><br/></div><div>cartfile依赖BiliUtils库.但是BiliUtils库没有shared framwork shceme</div><div><img src="1-2-Carthage%E8%B8%A9%E5%9D%91.resources/68F03234-7623-4875-B983-86F7CD22B416.png" height="54" width="512"/><br/></div><div><img src="1-2-Carthage%E8%B8%A9%E5%9D%91.resources/29270308-C803-4C0B-80B9-8EBF0CFF6231.png" height="104" width="616"/><br/></div><div><img src="1-2-Carthage%E8%B8%A9%E5%9D%91.resources/111FC0DF-7408-40A3-AC8E-510B7D6BE606.png" height="120" width="746"/><br/></div><div><img src="1-2-Carthage%E8%B8%A9%E5%9D%91.resources/806FD1AB-44D6-4BB8-9FE2-77EF0CA87E00.png" height="108" width="754"/><br/></div><div>会发现carthage只能把BiliUtils库拉取下来.但是没有build出.framwork</div><div><br/></div><div><span style="color: rgb(170, 121, 66);">卡比总结:</span></div><div><span style="color: rgb(170, 121, 66);">utils只有最新的tag做了sharescheme</span></div><div><br/></div><hr/><div><br/></div><div><span style="font-size: 28px;">问题五:carthage update 运行报错.</span></div><div>拉取的是BBAd的1.0.1tag号.</div><div>检查发现BBAd是对BFC.BiliUtils.BiliCore工程依赖的.</div><div>但是这个tag号下.BBAd工程还没有创建cartfile文件.</div><div>所以carthage编译的时候报错了.</div><div><img src="1-2-Carthage%E8%B8%A9%E5%9D%91.resources/51D1948B-6D6B-4C1D-8DC8-3F2561F33F21.png" height="172" width="621"/><br/></div><div><br/></div><div><span style="color: rgb(170, 121, 66);">卡比总结:</span></div><div><span style="color: rgb(170, 121, 66);">由于我们代码依然存在兄弟工程非ftamework式依赖。有些库例如hilicore必须源码级别展开才可变异。（涉及库 bilicore bilutils bbad）此些库可采取手动进入carthage/checkouts 相应porject进行手动编译.</span><span style="color: rgb(170, 121, 66);">看什么错误什么依赖缺失后之后 再carthage build</span></div><div><br/></div><div><br/></div><hr/><div><br/></div><div><span style="font-size: 25px;">问题六:cartfile填写的依赖分支都是对的.打出来的包却还是develop的.</span></div><div><br/></div><div><img src="1-2-Carthage%E8%B8%A9%E5%9D%91.resources/4013DAAA-35C0-49C0-8B6A-234E0E5FA467.png" height="322" width="463"/><br/></div><div>这是6:35打出来的BBAd的framework.</div><div><br/></div><div>1.然后我修改了cartfile对BBAd库依赖的分支.从develop改为1.0.1</div><div>2.重新运行carthage update.并且加上—no-build参数.</div><div><img src="1-2-Carthage%E8%B8%A9%E5%9D%91.resources/A1296402-E4B6-4A1A-B638-D0F14AE30300.png" height="325" width="618"/><br/></div><div>3.再去这个目录查看.发现BBAd.framwork还是6:35打出来的.并没有更改.</div><div><br/></div><div>原因:</div><div>carthage update --platform iOS --cache-builds --verbose <span style="color: rgb(255, 38, 0);">--no-build</span></div><div><br/></div><div>罪魁祸首就是这个—no-build</div><div>如果update的时候加了这个参数.他就只会重新拉取对应分支代码.但是不会build这个库.</div><div>所以运行build.sh脚本的时候.最好先打开看看里面的carthage命令是否加了什么不可描述的参数.</div><div><br/></div><div><br/></div><hr/><div><br/></div><div><span style="font-size: 27px;">问题七:BiliCore的python脚本编译失败</span></div><div><br/></div><div>终端ping一下.</div><div>没毛病ping一下.</div><div><img src="1-2-Carthage%E8%B8%A9%E5%9D%91.resources/DEF283D4-0177-4644-97CA-0B28D82924DF.png" height="209" width="970"/><br/></div><div><img src="1-2-Carthage%E8%B8%A9%E5%9D%91.resources/E76B7FBF-43B6-46F2-8EC1-00BC09313B2B.png" height="314" width="1072"/><br/></div><div><br/></div><hr/><div><br/></div><div><span style="font-size: 24px;">问题八: because an item with the same name already exists</span></div><div><img src="1-2-Carthage%E8%B8%A9%E5%9D%91.resources/F01EFF44-ECC4-41FA-B6C5-368771E3FD3D.png" height="214" width="538"/><br/></div><div>可以发现cartfile.resolved解析文件里有两个BFCTracker.</div><div>为什么会有两个呢.</div><div><br/></div><div><span style="font-size: 23px;">原因:</span></div><div>1.你自己依赖了BFCTracker库</div><div>2.你依赖的一个源码级库(比如BiliCore)里面也依赖了BFCTracker.但是他写的path是..../BFCTracker/meta.</div><div>导致carthage认为这是两个库.但是拉下来后发现他们俩名字是一样的.所以就报错了.</div><div><br/></div><div><br/></div><div><span style="font-size: 26px;">问题九: GitLab: Failed to authorize your git request</span></div><div><img src="1-2-Carthage%E8%B8%A9%E5%9D%91.resources/56C74357-8EA7-4892-94FE-A918CD24E5A3.png" height="169" width="608"/><br/></div><div><span style="font: 12.0px 'Andale Mono'; font-variant-ligatures: no-common-ligatures; color: #6a42f7; background-color: rgba(30, 30, 30, 0.87);">***</span><span style="font: 12.0px 'Andale Mono'; font-variant-ligatures: no-common-ligatures; color: #28fe14; background-color: rgba(30, 30, 30, 0.87);"> Downloading binary-only framework </span><span style="font: 12.0px 'Andale Mono'; font-variant-ligatures: no-common-ligatures; color: #00f900; background-color: rgba(30, 30, 30, 0.87);">BBPictureShow</span><span style="font: 12.0px 'Andale Mono'; font-variant-ligatures: no-common-ligatures; color: #28fe14; background-color: rgba(30, 30, 30, 0.87);"> at </span><span style="font: 12.0px 'Andale Mono'; font-variant-ligatures: no-common-ligatures; color: #42c732; background-color: rgba(30, 30, 30, 0.87);">"</span><a style="font: 12.0px 'Andale Mono'; font-variant-ligatures: no-common-ligatures; color: #42c732; background-color: rgba(30, 30, 30, 0.87);" href="https://172.16.0.97/api/v1/carthage/BBPictureShow">https://172.16.0.97/api/v1/carthage/BBPictureShow</a><span style="font: 12.0px 'Andale Mono'; font-variant-ligatures: no-common-ligatures; color: #42c732; background-color: rgba(30, 30, 30, 0.87);">"</span></div><div><span style="font: 12.0px 'Andale Mono'; font-variant-ligatures: no-common-ligatures; color: #28fe14; background-color: rgba(30, 30, 30, 0.87);">A shell task (/usr/bin/env git fetch --prune --quiet git@syncsvn.bilibili.co:ios/BiliUtils.git refs/tags/*:refs/tags/* +refs/heads/*:refs/heads/* (launched in /Users/bilibili/Library/Caches/org.carthage.CarthageKit/dependencies/BiliUtils)) failed with exit code 128:</span></div><div><span style="font: 12.0px 'Andale Mono'; font-variant-ligatures: no-common-ligatures; color: #28fe14; background-color: rgba(30, 30, 30, 0.87);">GitLab: Failed to authorize your Git request: internal API unreachable</span></div><div><span style="font: 12.0px 'Andale Mono'; font-variant-ligatures: no-common-ligatures; color: #28fe14; background-color: rgba(30, 30, 30, 0.87);">fatal: Could not read from remote repository.</span></div><div><br/></div><div><span style="font: 12.0px 'Andale Mono'; font-variant-ligatures: no-common-ligatures; color: #28fe14; background-color: rgba(30, 30, 30, 0.87);">Please make sure you have the correct access rights</span></div><div><span style="font: 12.0px 'Andale Mono'; font-variant-ligatures: no-common-ligatures; color: #28fe14; background-color: rgba(30, 30, 30, 0.87);">and the repository exists.</span></div><div><br/></div><div>gitlab炸了? </div><div>过了一会再拉就好了.......</div><div><br/></div><div><br/></div><div><span style="font-size: 24px;">问题十: 证书错误</span></div><div><img src="1-2-Carthage%E8%B8%A9%E5%9D%91.resources/1D413C22547B5689AB8CA4521E8DABF4.png" height="253" width="849"/><br/></div><div>你开了charles了.</div><div>charles拦截了你的证书.关了就可以了.</div><div><br/></div><div><br/></div><div><font style="font-size: 26px;">问题十一:BBPhone库找不到头文件</font></div><div>描述:</div><div>报错BFCRuler库里的BFCWebViewController头文件找不到.</div><div>但是你去BFCRuler库的文件夹里找到他发现.headers里面是有这个头文件的.</div><div><br/></div><div>原因:</div><div>你是去壳工程的carthage目录里找的BFCRuler库.因为你更新了科工程的carthage.</div><div>但是你没更新BBPhone工程的carthage.所以BBPhone工程用的还是老的BFCRuler.他当然找不到了.</div><div><br/></div><div>解决:进入BBPhone工程目录下.更新carthage</div><div><br/></div><div><img src="1-2-Carthage%E8%B8%A9%E5%9D%91.resources/F09EF882-38BC-4AAA-A143-2A2347E30BA4.png" height="74" width="1224"/><br/></div><div><br/></div></body></html>